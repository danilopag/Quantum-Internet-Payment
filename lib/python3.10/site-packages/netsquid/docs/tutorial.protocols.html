<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Protocols &mdash; NetSquid 1.1.7 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=370aedac"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Quantum Processor" href="tutorial.quantumprocessor.html" />
    <link rel="prev" title="Nodes and Connections" href="tutorial.nodes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #E3E3E3" >

          
          
          <a href="index.html" class="icon icon-home">
            NetSquid
              <img src="_static/squid-150.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.1.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUTHORS.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learn NetSquid</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">NetSquid in 10 minutes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.intro.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.qubits.html">Qubits and quantum computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.pydynaa.html">Discrete event simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.components.html">Modelling of network components</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.nodes.html">Nodes and Connections</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.quantumprocessor.html">The Quantum Processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.simulation.html">A full simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="learn.examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.teleportation.html">Teleportation</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.repeater.html">Repeater with purification</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.repeater_chain.html">Repeater chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.simple_link.html">A simple link layer protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.magic_simple_link.html">Faster Link layer Protocol using abstraction</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">NetSquid package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="netsquid.qubits.html">netsquid.qubits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qformalism.html">netsquid.qubits.qformalism</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qubitapi.html">netsquid.qubits.qubitapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.operators.html">netsquid.qubits.operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.cliffords.html">netsquid.qubits.cliffords</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.ketstates.html">netsquid.qubits.ketstates</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.state_sampler.html">netsquid.qubits.state_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qubit.html">netsquid.qubits.qubit</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qstate.html">netsquid.qubits.qstate</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qrepr.html">netsquid.qubits.qrepr</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.kettools.html">netsquid.qubits.kettools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.dmtools.html">netsquid.qubits.dmtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.sparsedmtools.html">netsquid.qubits.sparsedmtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.stabtools.html">netsquid.qubits.stabtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.gslctools.html">netsquid.qubits.gslctools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qreprutil.html">netsquid.qubits.qreprutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.ketutil.html">netsquid.qubits.ketutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.dmutil.html">netsquid.qubits.dmutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.sparseutil.html">netsquid.qubits.sparseutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.gslcutil.html">netsquid.qubits.gslcutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.opmath.html">netsquid.qubits.opmath</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.components.html">netsquid.components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.component.html">netsquid.components.component</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.channel.html">netsquid.components.channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qchannel.html">netsquid.components.qchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.cchannel.html">netsquid.components.cchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.cqchannel.html">netsquid.components.cqchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qmemory.html">netsquid.components.qmemory</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.instructions.html">netsquid.components.instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qprogram.html">netsquid.components.qprogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qprocessor.html">netsquid.components.qprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.clock.html">netsquid.components.clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qsource.html">netsquid.components.qsource</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qdetector.html">netsquid.components.qdetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.switch.html">netsquid.components.switch</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.ccoding.html">netsquid.components.ccoding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.components.models.html">netsquid.components.models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.model.html">netsquid.components.models.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.delaymodels.html">netsquid.components.models.delaymodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.errormodels.html">netsquid.components.models.errormodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.qerrormodels.html">netsquid.componentsmodels.qerrormodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.cerrormodels.html">netsquid.components.models.cerrormodels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.nodes.html">netsquid.nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.node.html">netsquid.nodes.node</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.connections.html">netsquid.nodes.connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.network.html">netsquid.nodes.network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.protocols.html">netsquid.protocols</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html">netsquid.protocols.protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.nodeprotocols.html">netsquid.protocols.nodeprotocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.serviceprotocol.html">netsquid.protocols.serviceprotocol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.util.html">netsquid.util</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simtools.html">netsquid.util.simtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simlog.html">netsquid.util.simlog</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simstats.html">netsquid.util.simstats</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.datacollector.html">netsquid.util.datacollector</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.cycache.html">netsquid.util.cycache</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.cymath.html">netsquid.util.cymath</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.constrainedmap.html">netsquid.util.constrainedmap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.examples.html">netsquid.examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.teleportation.html">netsquid.examples.teleportation</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.entanglenodes.html">netsquid.examples.entanglenodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.purify.html">netsquid.examples.purify</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.repeater.html">netsquid.examples.repeater</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.repeater_chain.html">netsquid.examples.repeater_chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.simple_link.html">netsquid.examples.simple_link</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.magic_simple_link.html">netsquid.examples.magic_simple_link</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_pydynaa.html">pyDynAA package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html">pydynaa.Entity</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-event">pydynaa.Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventtype">pydynaa.EventType</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventexpression">pydynaa.EventExpression</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventhandler">pydynaa.EventHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-expressionhandler">pydynaa.ExpressionHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-simulationengine">pydynaa.SimulationEngine</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="INSTALL-SOURCE.html">Installation from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #E3E3E3" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NetSquid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorial.intro.html">Tutorial</a></li>
      <li class="breadcrumb-item active">Protocols</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.protocols.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="tutorial.nodes.html" class="btn btn-neutral float-left" title="Nodes and Connections" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.quantumprocessor.html" class="btn btn-neutral float-right" title="The Quantum Processor" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="protocols">
<h1>Protocols<a class="headerlink" href="#protocols" title="Link to this heading"></a></h1>
<p>Now that nodes (<a class="reference internal" href="api_nodes/netsquid.nodes.node.html#netsquid.nodes.node.Node" title="netsquid.nodes.node.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a>) and connections (<a class="reference internal" href="api_nodes/netsquid.nodes.connections.html#netsquid.nodes.connections.Connection" title="netsquid.nodes.connections.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>)
are set up, protocols (<a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol" title="netsquid.protocols.protocol.Protocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">Protocol</span></code></a>) can be attached to the nodes.
In contrast to components, which represent physical entities in a simulation (the <strong>hardware</strong>),
protocols are <em>virtual simulation entities</em> that steer component behaviour (the <strong>software</strong>).
For example, a protocol may instruct a quantum processor to measure one of its qubits upon receiving a classical message on one of its node’s ports.
In this section of the tutorial we show how to use protocols to teleport a qubit from Alice to Bob.</p>
<p class="topic-title">Learning goals</p><ul class="simple">
<li><p>Using protocols to manage components
(<strong>essential</strong>).</p></li>
<li><p>Using the yield statement to wait on event expressions
(<strong>advanced</strong>).</p></li>
</ul>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#protocol" id="id1">Protocol</a></p></li>
<li><p><a class="reference internal" href="#the-ping-pong-example-using-protocols" id="id2">The ping pong example using protocols</a></p></li>
<li><p><a class="reference internal" href="#the-teleportation-example-using-protocols" id="id3">The teleportation example using protocols <sup>*</sup></a></p></li>
</ul>
</nav>
<p><em>Advanced sections are denoted by an asterix (*).</em></p>
<section id="protocol">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Protocol</a><a class="headerlink" href="#protocol" title="Link to this heading"></a></h2>
<p>There are two ways to create protocols, either with callbacks as described in the <a class="reference external" href="tutorial.pydynaa.html">pydynaa tutorial</a>
or as a python generator.
In this tutorial the second option will be explained; with a generator the asynchronous flow of a protocol is generally easier to follow.
The main protocol methods are:</p>
<ul>
<li><dl class="simple">
<dt><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.start" title="netsquid.protocols.protocol.Protocol.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code></a></dt><dd><p>starts the protocol and generally resets any state variables.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.stop" title="netsquid.protocols.protocol.Protocol.stop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop()</span></code></a></dt><dd><p>stops the protocol but should not modify any state variables.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.reset" title="netsquid.protocols.protocol.Protocol.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a></dt><dd><p>stops and then restarts the protocol.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.run" title="netsquid.protocols.protocol.Protocol.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a></dt><dd><p>Here the flow of the protocol can be defined.
Within the run() method you can <code class="docutils literal notranslate"><span class="pre">yield</span></code> on <a class="reference internal" href="pydynaa.html#pydynaa.core.EventExpression" title="pydynaa.core.EventExpression"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EventExpression</span></code></a>s.
<code class="docutils literal notranslate"><span class="pre">yield</span></code> is used to create a <a class="reference external" href="https://docs.python.org/3/glossary.html#term-generator-iterator">generator iterator</a>.
When executing such a generator function it runs until the first <code class="docutils literal notranslate"><span class="pre">yield</span></code>, where it will be suspended.
The generator remembers where it was suspended,
so when resuming the generator it picks up where it left off, and runs until the next <code class="docutils literal notranslate"><span class="pre">yield</span></code>.</p>
<p>We use this to create inline callbacks by yielding on an <a class="reference internal" href="pydynaa.html#pydynaa.core.EventExpression" title="pydynaa.core.EventExpression"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EventExpression</span></code></a>.
When the event expression triggers (usually at a later point in the simulation)
the protocol resumes and runs until the next <code class="docutils literal notranslate"><span class="pre">yield</span></code> or <code class="docutils literal notranslate"><span class="pre">return</span></code>.</p>
</dd>
</dl>
</li>
</ul>
<p>A simple example protocol that sleeps for 100 nanoseconds:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.protocols</span> <span class="kn">import</span> <span class="n">Protocol</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">WaitProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting protocol at </span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_timer</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ending protocol at </span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">sim_reset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">protocol</span> <span class="o">=</span> <span class="n">WaitProtocol</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">protocol</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Starting protocol at 0.0</span>
<span class="go">WaitProtocol(&#39;WaitProtocol&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">()</span>
<span class="go">Ending protocol at 100.0</span>
</pre></div>
</div>
<p>When a protocol has finished it sends a <code class="docutils literal notranslate"><span class="pre">FINISHED</span></code> signal (<a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Signals" title="netsquid.protocols.protocol.Signals"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signals</span></code></a>) to inform any listening entities.
Signals are events of a specific type and with an optional result.
There are several other predefined signal types, notably <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code> and <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>.
A protocol can send signals using the <a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.send_signal" title="netsquid.protocols.protocol.Protocol.send_signal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_signal()</span></code></a> method.</p>
</section>
<section id="the-ping-pong-example-using-protocols">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">The ping pong example using protocols</a><a class="headerlink" href="#the-ping-pong-example-using-protocols" title="Link to this heading"></a></h2>
<p>The earlier game of quantum ping pong can also be written as two protocols.
Here instead of defining events and their callbacks, we can write a single generator for the whole sequence.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.protocols</span> <span class="kn">import</span> <span class="n">NodeProtocol</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.components</span> <span class="kn">import</span> <span class="n">QuantumChannel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.nodes</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">DirectConnection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.qubits</span> <span class="kn">import</span> <span class="n">qubitapi</span> <span class="k">as</span> <span class="n">qapi</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PingProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting ping at t=</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;port_to_channel&quot;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">qubit</span><span class="p">,</span> <span class="o">=</span> <span class="n">qapi</span><span class="o">.</span><span class="n">create_qubits</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">port</span><span class="o">.</span><span class="n">tx_output</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span>  <span class="c1"># Send qubit to Pong</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c1"># Wait for qubit to be received back</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">qubit</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">rx_input</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>            <span class="n">m</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">qapi</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">labels_z</span> <span class="o">=</span>  <span class="p">(</span><span class="s2">&quot;|0&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;|1&gt;&quot;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">}</span><span class="s2">: Pong event! </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> measured &quot;</span>
<span class="gp">... </span>                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels_z</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="si">}</span><span class="s2"> with probability </span><span class="si">{</span><span class="n">prob</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">port</span><span class="o">.</span><span class="n">tx_output</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span>  <span class="c1"># Send qubit to B</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PongProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting pong at t=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()))</span>
<span class="gp">... </span>        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;port_to_channel&quot;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">qubit</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">rx_input</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>            <span class="n">m</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">qapi</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">labels_x</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;|+&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;|-&gt;&quot;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">}</span><span class="s2">: Ping event! </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> measured &quot;</span>
<span class="gp">... </span>                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels_x</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="si">}</span><span class="s2"> with probability </span><span class="si">{</span><span class="n">prob</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">port</span><span class="o">.</span><span class="n">tx_output</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span>  <span class="c1"># send qubit to Ping</span>
</pre></div>
</div>
<p>We can run these two protocols on the nodes of our Ping and Pong entity.
We connect them with a direct connection and assign them their protocol.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">sim_reset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">set_random_state</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node_ping</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Ping&quot;</span><span class="p">,</span> <span class="n">port_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;port_to_channel&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node_pong</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Pong&quot;</span><span class="p">,</span> <span class="n">port_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;port_to_channel&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">connection</span> <span class="o">=</span> <span class="n">DirectConnection</span><span class="p">(</span><span class="s2">&quot;Connection&quot;</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="n">QuantumChannel</span><span class="p">(</span><span class="s2">&quot;Channel_LR&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">... </span>                              <span class="n">QuantumChannel</span><span class="p">(</span><span class="s2">&quot;Channel_RL&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node_ping</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;port_to_channel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node_pong</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;port_to_channel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ping_protocol</span> <span class="o">=</span> <span class="n">PingProtocol</span><span class="p">(</span><span class="n">node_ping</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pong_protocol</span> <span class="o">=</span> <span class="n">PongProtocol</span><span class="p">(</span><span class="n">node_pong</span><span class="p">)</span>
</pre></div>
</div>
<p>This is already the full setup we need, and now we can run the simulation.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ping_protocol</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Starting ping at t=0.0</span>
<span class="go">PingProtocol(Node(name=&#39;Ping&#39;), &#39;PingProtocol&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pong_protocol</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Starting pong at t=0.0</span>
<span class="go">PongProtocol(Node(name=&#39;Pong&#39;), &#39;PongProtocol&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="mi">91</span><span class="p">)</span>
<span class="go">10.0: Ping event! Pong measured |+&gt; with probability 0.50</span>
<span class="go">20.0: Pong event! Ping measured |1&gt; with probability 0.50</span>
<span class="go">30.0: Ping event! Pong measured |-&gt; with probability 0.50</span>
<span class="go">40.0: Pong event! Ping measured |1&gt; with probability 0.50</span>
<span class="go">50.0: Ping event! Pong measured |+&gt; with probability 0.50</span>
<span class="go">60.0: Pong event! Ping measured |0&gt; with probability 0.50</span>
<span class="go">70.0: Ping event! Pong measured |+&gt; with probability 0.50</span>
<span class="go">80.0: Pong event! Ping measured |1&gt; with probability 0.50</span>
<span class="go">90.0: Ping event! Pong measured |-&gt; with probability 0.50</span>
</pre></div>
</div>
<p>Note that these protocols never end; an end time has to be specified in <cite>sim_run()</cite>.
In this case we specified 91 nanoseconds.</p>
<p>What happens if the protocols are stopped or reset?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pong_protocol</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">()</span>  
<span class="go">100.0: Pong event! Ping measured |1&gt; with probability 0.50</span>
</pre></div>
</div>
<p>Now that the pong protocol is stopped the simulation can be run until there are no more events.
In the previous run, pong sent a qubit back to ping, but it was not yet processed. In this run, the lingering qubit arrived at the ping protocol.
The qubit is pinged back, but pong is stopped so does not process it. There was no one listening to the port, so now the qubit is lost.
When pong is started again, nothing will happen, since there is no qubit to pass back and forth.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pong_protocol</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Starting pong at t=110.0</span>
<span class="go">PongProtocol(Node(name=&#39;Pong&#39;), &#39;PongProtocol&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">()</span>
</pre></div>
</div>
<p>The ping protocol has to be reset to create a new qubit.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ping_protocol</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="go">Starting ping at t=110.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">51</span><span class="p">)</span>
<span class="go">120.0: Ping event! Pong measured |+&gt; with probability 0.50</span>
<span class="go">130.0: Pong event! Ping measured |1&gt; with probability 0.50</span>
<span class="go">140.0: Ping event! Pong measured |-&gt; with probability 0.50</span>
<span class="go">150.0: Pong event! Ping measured |0&gt; with probability 0.50</span>
<span class="go">160.0: Ping event! Pong measured |+&gt; with probability 0.50</span>
</pre></div>
</div>
</section>
<section id="the-teleportation-example-using-protocols">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">The teleportation example using protocols <sup>*</sup></a><a class="headerlink" href="#the-teleportation-example-using-protocols" title="Link to this heading"></a></h2>
<p>We are now ready to set up our teleportation example using protocols.
Alice will have a protocol to create the qubit state that she wants to teleport.
For now this protocol does not need to yield on anything, it will just create a random state.
When the qubit is created the protocol signals to the world that it succeeded and on which memory position the qubit is located.</p>
<p>You may think that Alice could simply send a signal with the measurement results, to which Bob could listen to.
However that would break locality; the message would have been sent faster than light to Bob!
To avoid this possibility a node protocol (<a class="reference internal" href="api_protocols/netsquid.protocols.nodeprotocols.html#netsquid.protocols.nodeprotocols.NodeProtocol" title="netsquid.protocols.nodeprotocols.NodeProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">NodeProtocol</span></code></a>) can be used.
Such a protocol has access to only one node, and also ensures protocols can only signal to other protocols on that node i.e. at the same location.
If a protocol should have access to a limited set of nodes a local protocol (<a class="reference internal" href="api_protocols/netsquid.protocols.nodeprotocols.html#netsquid.protocols.nodeprotocols.LocalProtocol" title="netsquid.protocols.nodeprotocols.LocalProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalProtocol</span></code></a>) can be used, or a regular protocol (<a class="reference internal" href="api_protocols/netsquid.protocols.nodeprotocols.html#netsquid.protocols.nodeprotocols.LocalProtocol" title="netsquid.protocols.nodeprotocols.LocalProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalProtocol</span></code></a>) if locality is not of concern.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.protocols</span> <span class="kn">import</span> <span class="n">NodeProtocol</span><span class="p">,</span> <span class="n">Signals</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">InitStateProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">qubit</span><span class="p">,</span> <span class="o">=</span> <span class="n">qapi</span><span class="o">.</span><span class="n">create_qubits</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">mem_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">unused_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">mem_pos</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">mem_pos</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">mem_pos</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">signal_label</span><span class="o">=</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">mem_pos</span><span class="p">)</span>
</pre></div>
</div>
<p>Next Alice needs a protocol to perform her Bell measurement.
Before she can do the measurement both the qubit
she wants to teleport and the qubit that is entangled with Bob needs to be in her memory,
so Alice needs to wait for both of them.
In principle they can arrive in any order, so Alice will need to wait for both of them simultaneously.
This can be done by combining the event expressions with the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (AND) operator, which waits until both expressions are triggered:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expression_and</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">expression1</span> <span class="o">&amp;</span> <span class="n">expression2</span>  
</pre></div>
</div>
<p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">|</span></code> (OR) operator waits until one expression is triggered:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expression_or</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">expression3</span> <span class="o">|</span> <span class="n">expression4</span>  
</pre></div>
</div>
<p>The event expression that is returned is a copy of the event expression that was yielded on.
This new copied event expression has information on which expression was triggered.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expression_or</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># Is true if expression3 was triggered  </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expression_or</span><span class="o">.</span><span class="n">second_term</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># Is true if expression4 was triggered  </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># list of all events that caused the expression to trigger:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expression_or</span><span class="o">.</span><span class="n">triggered_events</span>    
</pre></div>
</div>
<p>Alice waits for a signal of the InitStateProtocol (i.e. her qubit being prepared), and until the entangled qubit gets placed on the
memory. Once both have occurred she can do the measurement and send the measurement results to Bob.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pydynaa</span> <span class="kn">import</span> <span class="n">EventExpression</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BellMeasurementProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">qubit_protocol</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_subprotocol</span><span class="p">(</span><span class="n">qubit_protocol</span><span class="p">,</span> <span class="s1">&#39;qprotocol&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">qubit_initialised</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">... </span>        <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">evexpr_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_signal</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subprotocols</span><span class="p">[</span><span class="s1">&#39;qprotocol&#39;</span><span class="p">],</span>
<span class="gp">... </span>                <span class="n">signal_label</span><span class="o">=</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">evexpr_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;qin_charlie&quot;</span><span class="p">])</span>
<span class="gp">... </span>            <span class="n">expression</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">evexpr_signal</span> <span class="o">|</span> <span class="n">evexpr_port</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">expression</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<span class="gp">... </span>                 <span class="c1"># First expression was triggered</span>
<span class="gp">... </span>                <span class="n">qubit_initialised</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>            <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>                <span class="c1"># Second expression was triggered</span>
<span class="gp">... </span>                <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">qubit_initialised</span> <span class="ow">and</span> <span class="n">entanglement_ready</span><span class="p">:</span>
<span class="gp">... </span>                <span class="c1"># Perform Bell measurement:</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>                <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">measure</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">... </span>                <span class="c1"># Send measurement results to Bob:</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;cout_bob&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tx_output</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">)</span>
<span class="gp">... </span>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Alice received entangled qubit, &quot;</span>
<span class="gp">... </span>                      <span class="sa">f</span><span class="s2">&quot;measured qubits &amp; sending corrections&quot;</span><span class="p">)</span>
<span class="gp">... </span>                <span class="k">break</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">start_subprotocols</span><span class="p">()</span>
</pre></div>
</div>
<p>Bob needs to perform corrections on the qubit it received from the source. So Bob also needs to wait for two things to
occur; the classical data he receives from Alice, and the entangled qubit that gets placed in Bob’s memory.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CorrectionProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">port_alice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;cin_alice&quot;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">port_charlie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;qin_charlie&quot;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">... </span>        <span class="n">meas_results</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">evexpr_port_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="n">port_alice</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">evexpr_port_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="n">port_charlie</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">expression</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">evexpr_port_a</span> <span class="o">|</span> <span class="n">evexpr_port_c</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">expression</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<span class="gp">... </span>                <span class="n">meas_results</span> <span class="o">=</span> <span class="n">port_alice</span><span class="o">.</span><span class="n">rx_input</span><span class="p">()</span><span class="o">.</span><span class="n">items</span>
<span class="gp">... </span>            <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>                <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">meas_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">entanglement_ready</span><span class="p">:</span>
<span class="gp">... </span>                <span class="k">if</span> <span class="n">meas_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<span class="gp">... </span>                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>                <span class="k">if</span> <span class="n">meas_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<span class="gp">... </span>                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>                <span class="n">fidelity</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">fidelity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">peek</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>                                              <span class="n">ns</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Bob received entangled qubit and &quot;</span>
<span class="gp">... </span>                      <span class="sa">f</span><span class="s2">&quot;corrections! Fidelity = </span><span class="si">{</span><span class="n">fidelity</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>                <span class="k">break</span>
</pre></div>
</div>
<p>To finish we build the example network from the previous tutorial, assign the protocols and run the simulation.
The <cite>example_network_setup</cite> now returns <cite>network</cite> instead of the nodes and connections.
This is a convenient class (<code class="xref py py-obj docutils literal notranslate"><span class="pre">Network</span></code>) that can hold all nodes and connections of
a network.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">netsquid.examples.teleportation</span> <span class="kn">import</span> <span class="n">example_network_setup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">sim_reset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">set_qstate_formalism</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">QFormalism</span><span class="o">.</span><span class="n">DM</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">set_random_state</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">network</span> <span class="o">=</span> <span class="n">example_network_setup</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_state_protocol</span> <span class="o">=</span> <span class="n">InitStateProtocol</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bell_measure_protocol</span> <span class="o">=</span> <span class="n">BellMeasurementProtocol</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">random_state_protocol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">correction_protocol</span> <span class="o">=</span> <span class="n">CorrectionProtocol</span><span class="p">(</span><span class="n">bob</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bell_measure_protocol</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">correction_protocol</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go">10.0: Alice received entangled qubit, measured qubits &amp; sending corrections</span>
<span class="go">30.0: Bob received entangled qubit and corrections! Fidelity = 0.870</span>
</pre></div>
</div>
<p>Our fidelity dropped from the previous 0.909 to 0.870 due to our prepared qubit now having to wait idly in the quantum memory before for the entangled qubit to arrive before we perform the bell measurement.</p>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<p>Helper methods of the protocol base class:</p>
<ul class="simple">
<li><p><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.await_timer" title="netsquid.protocols.protocol.Protocol.await_timer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">await_timer()</span></code></a> - Starts a timer and returns an EventExpression that trigger after the set amount</p></li>
<li><p><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.await_signal" title="netsquid.protocols.protocol.Protocol.await_signal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">await_signal()</span></code></a> - Wait for an other protocol to signal something. LocalProtocols and NodeProtocols can only receive signals from local protocols</p></li>
<li><p><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.await_port_input" title="netsquid.protocols.protocol.Protocol.await_port_input"><code class="xref py py-meth docutils literal notranslate"><span class="pre">await_port_input()</span></code></a> - Wait until a message arrives at a port input</p></li>
<li><p><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html#netsquid.protocols.protocol.Protocol.await_port_output" title="netsquid.protocols.protocol.Protocol.await_port_output"><code class="xref py py-meth docutils literal notranslate"><span class="pre">await_port_output()</span></code></a> - Wait until a message arrives at a port output</p></li>
</ul>
</section>
<section id="what-is-next">
<h3>What is next?<a class="headerlink" href="#what-is-next" title="Link to this heading"></a></h3>
<p>In the next tutorial we will introduce the quantum processor, which gives us more options for qubit manipulation.
Instead of perfect and instanteous operations it can handle physical instructions.
Afterwards we will run the teleportation protocol multiple times and gather and plot some data.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial.nodes.html" class="btn btn-neutral float-left" title="Nodes and Connections" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.quantumprocessor.html" class="btn btn-neutral float-right" title="The Quantum Processor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2021, TNO and TUDelft (QuTech).</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 1.1.7
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      <dd><a href="/1-1-stable/">1.1.5</a></dd>
      <dd><a href="/1-0-stable/">1.0.7</a></dd>
      <dd><a href="/0-10-stable/">0.10.4</a></dd>
      <dd><a href="/0-9-stable/">0.9.11</a></dd>
      <dd><a href="/0-8-stable/">0.8.7</a></dd>
      <dd><a href="/0-7-stable/">0.7.5</a></dd>
      <dd><a href="/0-6-stable/">0.6.4</a></dd>
      <dd><a href="/0-5-stable/">0.5.2</a></dd>
      <dd><a href="/0-4-stable/">0.4.2</a></dd>
      <dd><a href="/0-3-stable/">0.3.5</a></dd>
      <dd><a href="/latest-release/">latest release</a></dd>
      <dd><a href="/master/">master branch</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".highlight-default .highlight").each(function() {
            if ($(this).find(".gp").length > 0) {
             $(this).prepend("<div class='codebtn btn btn-neutral float-right'><div class='gp'>>>></div><div>");
             $(this).children("pre").contents().filter(function() {return this.nodeType === 3;}).wrap("<span></span>").end();
            }
        });
        $(".highlight-default .highlight .codebtn").click(function() {
            $(this).parent().children("pre").find(".gp").toggleClass("hidden");
            var traceback_elem = $(this).parent().children("pre").find(".gt, .go");
            traceback_elem.toggleClass("hidden");
            traceback_elem.nextUntil(".gp, .go").toggleClass("hidden");

        })
    });
</script>


</body>
</html>