<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A full simulation &mdash; NetSquid 1.1.7 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=370aedac"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="learn.examples.html" />
    <link rel="prev" title="The Quantum Processor" href="tutorial.quantumprocessor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #E3E3E3" >

          
          
          <a href="index.html" class="icon icon-home">
            NetSquid
              <img src="_static/squid-150.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.1.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUTHORS.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learn NetSquid</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">NetSquid in 10 minutes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.intro.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.qubits.html">Qubits and quantum computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.pydynaa.html">Discrete event simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.components.html">Modelling of network components</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.nodes.html">Nodes and Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.protocols.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.quantumprocessor.html">The Quantum Processor</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">A full simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="learn.examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.teleportation.html">Teleportation</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.repeater.html">Repeater with purification</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.repeater_chain.html">Repeater chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.simple_link.html">A simple link layer protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.magic_simple_link.html">Faster Link layer Protocol using abstraction</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">NetSquid package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="netsquid.qubits.html">netsquid.qubits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qformalism.html">netsquid.qubits.qformalism</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qubitapi.html">netsquid.qubits.qubitapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.operators.html">netsquid.qubits.operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.cliffords.html">netsquid.qubits.cliffords</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.ketstates.html">netsquid.qubits.ketstates</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.state_sampler.html">netsquid.qubits.state_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qubit.html">netsquid.qubits.qubit</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qstate.html">netsquid.qubits.qstate</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qrepr.html">netsquid.qubits.qrepr</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.kettools.html">netsquid.qubits.kettools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.dmtools.html">netsquid.qubits.dmtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.sparsedmtools.html">netsquid.qubits.sparsedmtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.stabtools.html">netsquid.qubits.stabtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.gslctools.html">netsquid.qubits.gslctools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qreprutil.html">netsquid.qubits.qreprutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.ketutil.html">netsquid.qubits.ketutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.dmutil.html">netsquid.qubits.dmutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.sparseutil.html">netsquid.qubits.sparseutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.gslcutil.html">netsquid.qubits.gslcutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.opmath.html">netsquid.qubits.opmath</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.components.html">netsquid.components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.component.html">netsquid.components.component</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.channel.html">netsquid.components.channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qchannel.html">netsquid.components.qchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.cchannel.html">netsquid.components.cchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.cqchannel.html">netsquid.components.cqchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qmemory.html">netsquid.components.qmemory</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.instructions.html">netsquid.components.instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qprogram.html">netsquid.components.qprogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qprocessor.html">netsquid.components.qprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.clock.html">netsquid.components.clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qsource.html">netsquid.components.qsource</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qdetector.html">netsquid.components.qdetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.switch.html">netsquid.components.switch</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.ccoding.html">netsquid.components.ccoding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.components.models.html">netsquid.components.models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.model.html">netsquid.components.models.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.delaymodels.html">netsquid.components.models.delaymodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.errormodels.html">netsquid.components.models.errormodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.qerrormodels.html">netsquid.componentsmodels.qerrormodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.cerrormodels.html">netsquid.components.models.cerrormodels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.nodes.html">netsquid.nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.node.html">netsquid.nodes.node</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.connections.html">netsquid.nodes.connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.network.html">netsquid.nodes.network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.protocols.html">netsquid.protocols</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html">netsquid.protocols.protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.nodeprotocols.html">netsquid.protocols.nodeprotocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.serviceprotocol.html">netsquid.protocols.serviceprotocol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.util.html">netsquid.util</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simtools.html">netsquid.util.simtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simlog.html">netsquid.util.simlog</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simstats.html">netsquid.util.simstats</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.datacollector.html">netsquid.util.datacollector</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.cycache.html">netsquid.util.cycache</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.cymath.html">netsquid.util.cymath</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.constrainedmap.html">netsquid.util.constrainedmap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.examples.html">netsquid.examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.teleportation.html">netsquid.examples.teleportation</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.entanglenodes.html">netsquid.examples.entanglenodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.purify.html">netsquid.examples.purify</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.repeater.html">netsquid.examples.repeater</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.repeater_chain.html">netsquid.examples.repeater_chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.simple_link.html">netsquid.examples.simple_link</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.magic_simple_link.html">netsquid.examples.magic_simple_link</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_pydynaa.html">pyDynAA package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html">pydynaa.Entity</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-event">pydynaa.Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventtype">pydynaa.EventType</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventexpression">pydynaa.EventExpression</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventhandler">pydynaa.EventHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-expressionhandler">pydynaa.ExpressionHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-simulationengine">pydynaa.SimulationEngine</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="INSTALL-SOURCE.html">Installation from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #E3E3E3" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NetSquid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorial.intro.html">Tutorial</a></li>
      <li class="breadcrumb-item active">A full simulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.simulation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="tutorial.quantumprocessor.html" class="btn btn-neutral float-left" title="The Quantum Processor" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="learn.examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-full-simulation">
<h1>A full simulation<a class="headerlink" href="#a-full-simulation" title="Link to this heading"></a></h1>
<p>With the concepts of components, quantum programs on a quantum processor, and protocols explained we can now finalize and fine tune a complete teleportation protocol.</p>
<p>The full example can be found in the <code class="docutils literal notranslate"><span class="pre">netsquid/examples/teleportation.py</span></code> module.
You can find this file on your system using the following python commands:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">netsquid</span> <span class="k">as</span> <span class="nn">ns</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Teleportation example module is located at: &quot;</span>
<span class="gp">... </span>      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">teleportation</span><span class="o">.</span><span class="vm">__file__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">Teleportation example module is located at: .../netsquid/examples/teleportation.py</span>
</pre></div>
</div>
<p>We will highlight parts of this file here in this tutorial.</p>
<p class="topic-title">Learning goals</p><ul class="simple">
<li><p>Setup of a complete network using the network component
(<strong>advanced</strong>).</p></li>
<li><p>Setting up and running a simulation including data collection
(<strong>essential</strong>).</p></li>
</ul>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-the-complete-network" id="id1">Setting up the complete network <sup>*</sup></a></p></li>
<li><p><a class="reference internal" href="#setting-up-the-simulation" id="id2">Setting up the simulation</a></p></li>
<li><p><a class="reference internal" href="#running-a-simulation" id="id3">Running a simulation</a></p></li>
</ul>
</nav>
<p><em>Advanced sections are denoted by an asterix (*).</em></p>
<section id="setting-up-the-complete-network">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Setting up the complete network <sup>*</sup></a><a class="headerlink" href="#setting-up-the-complete-network" title="Link to this heading"></a></h2>
<p>The first step towards running a simulation in NetSquid is to set up the physical network with all its components.
In the <a class="reference external" href="tutorial.nodes.html">Nodes and Connections tutorial</a> we saw how to set up a network between Alice and Bob.
We will use that network again here.
The main difference is that we will now want the quantum operations to take time and be noisy.
For this we need a quantum processor with physical instructions, instead of a quantum memory.</p>
<p>The connections that we will use between the nodes of Alice and Bob are defined similarly to before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EntanglingConnection</span><span class="p">(</span><span class="n">Connection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A connection that generates entanglement.</span>

<span class="sd">    Consists of a midpoint holding a quantum source that connects to</span>
<span class="sd">    outgoing quantum channels.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    length : float</span>
<span class="sd">        End to end length of the connection [km].</span>
<span class="sd">    source_frequency : float</span>
<span class="sd">        Frequency with which midpoint entanglement source generates entanglement [Hz].</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        Name of this connection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">source_frequency</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;EntanglingConnection&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">qsource</span> <span class="o">=</span> <span class="n">QSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;qsource_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">StateSampler</span><span class="p">([</span><span class="n">ks</span><span class="o">.</span><span class="n">b00</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">num_ports</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">timing_model</span><span class="o">=</span><span class="n">FixedDelayModel</span><span class="p">(</span><span class="n">delay</span><span class="o">=</span><span class="mf">1e9</span> <span class="o">/</span> <span class="n">source_frequency</span><span class="p">),</span>
                          <span class="n">status</span><span class="o">=</span><span class="n">SourceStatus</span><span class="o">.</span><span class="n">INTERNAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_subcomponent</span><span class="p">(</span><span class="n">qsource</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;qsource&quot;</span><span class="p">)</span>
        <span class="n">qchannel_c2a</span> <span class="o">=</span> <span class="n">QuantumChannel</span><span class="p">(</span><span class="s2">&quot;qchannel_C2A&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="n">models</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delay_model&quot;</span><span class="p">:</span> <span class="n">FibreDelayModel</span><span class="p">()})</span>
        <span class="n">qchannel_c2b</span> <span class="o">=</span> <span class="n">QuantumChannel</span><span class="p">(</span><span class="s2">&quot;qchannel_C2B&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="n">models</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delay_model&quot;</span><span class="p">:</span> <span class="n">FibreDelayModel</span><span class="p">()})</span>
        <span class="c1"># Add channels and forward quantum channel output to external port output:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_subcomponent</span><span class="p">(</span><span class="n">qchannel_c2a</span><span class="p">,</span> <span class="n">forward_output</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;recv&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_subcomponent</span><span class="p">(</span><span class="n">qchannel_c2b</span><span class="p">,</span> <span class="n">forward_output</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;recv&quot;</span><span class="p">)])</span>
        <span class="c1"># Connect qsource output to quantum channel input:</span>
        <span class="n">qsource</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;qout0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">qchannel_c2a</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;send&quot;</span><span class="p">])</span>
        <span class="n">qsource</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;qout1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">qchannel_c2b</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;send&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ClassicalConnection</span><span class="p">(</span><span class="n">Connection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A connection that transmits classical messages in one direction, from A to B.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    length : float</span>
<span class="sd">        End to end length of the connection [km].</span>
<span class="sd">    name : str, optional</span>
<span class="sd">       Name of this connection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ClassicalConnection&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_subcomponent</span><span class="p">(</span><span class="n">ClassicalChannel</span><span class="p">(</span><span class="s2">&quot;Channel_A2B&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
                                               <span class="n">models</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delay_model&quot;</span><span class="p">:</span> <span class="n">FibreDelayModel</span><span class="p">()}),</span>
                              <span class="n">forward_input</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">)],</span>
                              <span class="n">forward_output</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;recv&quot;</span><span class="p">)])</span>
</pre></div>
</div>
<p>The nodes of Alice and Bob each use the same quantum processor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_processor</span><span class="p">(</span><span class="n">depolar_rate</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory to create a quantum processor for each end node.</span>

<span class="sd">    Has two memory positions and the physical instructions necessary</span>
<span class="sd">    for teleportation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    depolar_rate : float</span>
<span class="sd">        Depolarization rate of qubits in memory.</span>
<span class="sd">    dephase_rate : float</span>
<span class="sd">        Dephasing rate of physical measurement instruction.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`~netsquid.components.qprocessor.QuantumProcessor`</span>
<span class="sd">        A quantum processor to specification.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We&#39;ll give both Alice and Bob the same kind of processor</span>
    <span class="n">measure_noise_model</span> <span class="o">=</span> <span class="n">DephaseNoiseModel</span><span class="p">(</span><span class="n">dephase_rate</span><span class="o">=</span><span class="n">dephase_rate</span><span class="p">,</span>
                                            <span class="n">time_independent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">physical_instructions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_INIT</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_H</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_X</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_Z</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_S</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_CNOT</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_MEASURE</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">quantum_noise_model</span><span class="o">=</span><span class="n">measure_noise_model</span><span class="p">,</span> <span class="n">apply_q_noise_after</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">PhysicalInstruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_MEASURE</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="n">memory_noise_model</span> <span class="o">=</span> <span class="n">DepolarNoiseModel</span><span class="p">(</span><span class="n">depolar_rate</span><span class="o">=</span><span class="n">depolar_rate</span><span class="p">)</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">QuantumProcessor</span><span class="p">(</span><span class="s2">&quot;quantum_processor&quot;</span><span class="p">,</span> <span class="n">num_positions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">memory_noise_models</span><span class="o">=</span><span class="p">[</span><span class="n">memory_noise_model</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                                 <span class="n">phys_instructions</span><span class="o">=</span><span class="n">physical_instructions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">processor</span>
</pre></div>
</div>
<p>The following funcion completes the network setup and returns the network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_network_setup</span><span class="p">(</span><span class="n">node_distance</span><span class="o">=</span><span class="mf">4e-3</span><span class="p">,</span> <span class="n">depolar_rate</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup the physical components of the quantum network.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node_distance : float, optional</span>
<span class="sd">        Distance between nodes.</span>
<span class="sd">    depolar_rate : float, optional</span>
<span class="sd">        Depolarization rate of qubits in memory.</span>
<span class="sd">    dephase_rate : float, optional</span>
<span class="sd">        Dephasing rate of physical measurement instruction.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`~netsquid.nodes.node.Network`</span>
<span class="sd">        A Network with nodes &quot;Alice&quot; and &quot;Bob&quot;,</span>
<span class="sd">        connected by an entangling connection and a classical connection</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup nodes Alice and Bob with quantum processor:</span>
    <span class="n">alice</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="n">qmemory</span><span class="o">=</span><span class="n">create_processor</span><span class="p">(</span><span class="n">depolar_rate</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="p">))</span>
    <span class="n">bob</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="n">qmemory</span><span class="o">=</span><span class="n">create_processor</span><span class="p">(</span><span class="n">depolar_rate</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="p">))</span>
    <span class="c1"># Create a network</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s2">&quot;Teleportation_network&quot;</span><span class="p">)</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">([</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">])</span>
    <span class="c1"># Setup classical connection between nodes:</span>
    <span class="n">c_conn</span> <span class="o">=</span> <span class="n">ClassicalConnection</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">node_distance</span><span class="p">)</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">c_conn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;classical&quot;</span><span class="p">,</span>
                           <span class="n">port_name_node1</span><span class="o">=</span><span class="s2">&quot;cout_bob&quot;</span><span class="p">,</span> <span class="n">port_name_node2</span><span class="o">=</span><span class="s2">&quot;cin_alice&quot;</span><span class="p">)</span>
    <span class="c1"># Setup entangling connection between nodes:</span>
    <span class="n">source_frequency</span> <span class="o">=</span> <span class="mf">4e4</span> <span class="o">/</span> <span class="n">node_distance</span>
    <span class="n">q_conn</span> <span class="o">=</span> <span class="n">EntanglingConnection</span><span class="p">(</span>
        <span class="n">length</span><span class="o">=</span><span class="n">node_distance</span><span class="p">,</span> <span class="n">source_frequency</span><span class="o">=</span><span class="n">source_frequency</span><span class="p">)</span>
    <span class="n">port_ac</span><span class="p">,</span> <span class="n">port_bc</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span>
        <span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">q_conn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;quantum&quot;</span><span class="p">,</span>
        <span class="n">port_name_node1</span><span class="o">=</span><span class="s2">&quot;qin_charlie&quot;</span><span class="p">,</span> <span class="n">port_name_node2</span><span class="o">=</span><span class="s2">&quot;qin_charlie&quot;</span><span class="p">)</span>
    <span class="n">alice</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_ac</span><span class="p">]</span><span class="o">.</span><span class="n">forward_input</span><span class="p">(</span><span class="n">alice</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s1">&#39;qin1&#39;</span><span class="p">])</span>
    <span class="n">bob</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_bc</span><span class="p">]</span><span class="o">.</span><span class="n">forward_input</span><span class="p">(</span><span class="n">bob</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s1">&#39;qin0&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">network</span>
</pre></div>
</div>
</section>
<section id="setting-up-the-simulation">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Setting up the simulation</a><a class="headerlink" href="#setting-up-the-simulation" title="Link to this heading"></a></h2>
<p>In a previous tutorial we saw how to create protocols and quantum programs.
Here we will execute programs within a protocol.</p>
<p>A quantum program is used instead of a protocol to create the state to be teleported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InitStateProgram</span><span class="p">(</span><span class="n">QuantumProgram</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Program to create a qubit and transform it to the y0 state.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_num_qubits</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">q1</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qubit_indices</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_INIT</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_H</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_S</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Also we will use a program to perform a Bell measurement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BellMeasurementProgram</span><span class="p">(</span><span class="n">QuantumProgram</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Program to perform a Bell measurement on two qubits.</span>

<span class="sd">    Measurement results are stored in output keys &quot;M1&quot; and &quot;M2&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_num_qubits</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qubit_indices</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_CNOT</span><span class="p">,</span> <span class="p">[</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_H</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_MEASURE</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;M1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_MEASURE</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;M2&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>We use these two programs in the protocol that runs on the node of Alice.</p>
<p>There are a few differences with the protocol in the <a class="reference external" href="tutorial.protocols.html">Protocols tutorial</a>.
Instead of initializing it with another protocol, the Bell measurement protocol now creates the program to initialise a state.
The program is executed, and the protocol yields until either the program is done or it has received the qubit from Charlie in its memory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BellMeasurementProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol to perform a Bell measurement when qubits are available.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qubit_initialised</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">qubit_init_program</span> <span class="o">=</span> <span class="n">InitStateProgram</span><span class="p">()</span>
        <span class="n">measure_program</span> <span class="o">=</span> <span class="n">BellMeasurementProgram</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">execute_program</span><span class="p">(</span><span class="n">qubit_init_program</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">await_program</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="p">)</span> <span class="o">|</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;qin_charlie&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">qubit_initialised</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">qubit_initialised</span> <span class="ow">and</span> <span class="n">entanglement_ready</span><span class="p">:</span>
                <span class="c1"># Once both qubits arrived, do BSM program and send to Bob</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">execute_program</span><span class="p">(</span><span class="n">measure_program</span><span class="p">)</span>
                <span class="n">m1</span><span class="p">,</span> <span class="o">=</span> <span class="n">measure_program</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;M1&quot;</span><span class="p">]</span>
                <span class="n">m2</span><span class="p">,</span> <span class="o">=</span> <span class="n">measure_program</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;M2&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;cout_bob&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tx_output</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">)</span>
                <span class="n">qubit_initialised</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">execute_program</span><span class="p">(</span><span class="n">qubit_init_program</span><span class="p">)</span>
</pre></div>
</div>
<p>On Bob’s side the corrections should also be done with instructions.
It is possible to execute single instructions instead of creating a new program for that.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CorrectionProtocol</span><span class="p">(</span><span class="n">NodeProtocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol to perform corrections on Bobs qubit when available and measurements received</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">port_alice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;cin_alice&quot;</span><span class="p">]</span>
        <span class="n">port_charlie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="s2">&quot;qin_charlie&quot;</span><span class="p">]</span>
        <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">meas_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Wait for measurement results of Alice or qubit from Charlie to arrive</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="n">port_alice</span><span class="p">)</span> <span class="o">|</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">await_port_input</span><span class="p">(</span><span class="n">port_charlie</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>  <span class="c1"># If measurements from Alice arrived</span>
                <span class="n">meas_results</span><span class="p">,</span> <span class="o">=</span> <span class="n">port_alice</span><span class="o">.</span><span class="n">rx_input</span><span class="p">()</span><span class="o">.</span><span class="n">items</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">meas_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">entanglement_ready</span><span class="p">:</span>
                <span class="c1"># Do corrections (blocking)</span>
                <span class="k">if</span> <span class="n">meas_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">execute_instruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_Z</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_program</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">meas_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">execute_instruction</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">INSTR_X</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_program</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">entanglement_ready</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">meas_results</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="running-a-simulation">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Running a simulation</a><a class="headerlink" href="#running-a-simulation" title="Link to this heading"></a></h2>
<p>We are now ready for a simulation.
You may have noticed that the protocols are adjusted slightly from the protocol tutorial section.
The results are reset and a program executed after all event expressions were triggered.
This is to setup the protocols for multiple runs.
The quantum source at Charlie is triggered on a timer.
Every time it triggers it causes Alice to teleport more qubits.</p>
<p>Once Bob has received and corrected its qubit we want to compare it with the initial qubit Alice had created.
This is done with a data collector (<a class="reference internal" href="api_util/netsquid.util.datacollector.html#netsquid.util.datacollector.DataCollector" title="netsquid.util.datacollector.DataCollector"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DataCollector</span></code></a>).
The data collector listens to certain events and stores results about the simulation.
Since it is intended to be used after a simulation a data collector can do actions that are normally not allowed,
such as reading out the full state of qubits (even if they are stored on multiple nodes, breaking locality).</p>
<p>The data collector fetches the qubit of Bob, measures the fidelity and discards the qubit.
The fidelity is stored inside the data collector.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_sim_setup</span><span class="p">(</span><span class="n">node_A</span><span class="p">,</span> <span class="n">node_B</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example simulation setup with data collector for teleportation protocol.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node_A : :class:`~netsquid.nodes.node.Node`</span>
<span class="sd">        Node corresponding to Alice.</span>
<span class="sd">    node_B : :class:`~netsquid.nodes.node.Node`</span>
<span class="sd">        Node corresponding to Bob.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`~netsquid.protocols.protocol.Protocol`</span>
<span class="sd">        Alice&#39;s protocol.</span>
<span class="sd">    :class:`~netsquid.protocols.protocol.Protocol`</span>
<span class="sd">        Bob&#39;s protocol.</span>
<span class="sd">    :class:`~netsquid.util.datacollector.DataCollector`</span>
<span class="sd">        Data collector to record fidelity.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">collect_fidelity_data</span><span class="p">(</span><span class="n">evexpr</span><span class="p">):</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="n">evexpr</span><span class="o">.</span><span class="n">triggered_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">source</span>
        <span class="n">mem_pos</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">get_signal_result</span><span class="p">(</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">)</span>
        <span class="n">qubit</span><span class="p">,</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">qmemory</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mem_pos</span><span class="p">)</span>
        <span class="n">fidelity</span> <span class="o">=</span> <span class="n">qapi</span><span class="o">.</span><span class="n">fidelity</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">qapi</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;fidelity&quot;</span><span class="p">:</span> <span class="n">fidelity</span><span class="p">}</span>

    <span class="n">protocol_alice</span> <span class="o">=</span> <span class="n">BellMeasurementProtocol</span><span class="p">(</span><span class="n">node_A</span><span class="p">)</span>
    <span class="n">protocol_bob</span> <span class="o">=</span> <span class="n">CorrectionProtocol</span><span class="p">(</span><span class="n">node_B</span><span class="p">)</span>
    <span class="n">dc</span> <span class="o">=</span> <span class="n">DataCollector</span><span class="p">(</span><span class="n">collect_fidelity_data</span><span class="p">)</span>
    <span class="n">dc</span><span class="o">.</span><span class="n">collect_on</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">EventExpression</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">protocol_bob</span><span class="p">,</span>
                                          <span class="n">event_type</span><span class="o">=</span><span class="n">Signals</span><span class="o">.</span><span class="n">SUCCESS</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">protocol_alice</span><span class="p">,</span> <span class="n">protocol_bob</span><span class="p">,</span> <span class="n">dc</span>
</pre></div>
</div>
<p>We will measure the average fidelity of 1000 runs and run that experiment for different depolarisation rates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">num_runs</span><span class="p">,</span> <span class="n">depolar_rates</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">4e-3</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup and run the simulation experiment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num_runs : int</span>
<span class="sd">        Number of cycles to run teleportation for.</span>
<span class="sd">    depolar_rates : list of float</span>
<span class="sd">        List of depolarization rates to repeat experiment for.</span>
<span class="sd">    distance : float, optional</span>
<span class="sd">        Distance between nodes [km].</span>
<span class="sd">    dephase_rate : float, optional</span>
<span class="sd">        Dephasing rate of physical measurement instruction.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`pandas.DataFrame`</span>
<span class="sd">        Dataframe with recorded fidelity data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fidelity_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">depolar_rate</span> <span class="ow">in</span> <span class="n">depolar_rates</span><span class="p">:</span>
        <span class="n">ns</span><span class="o">.</span><span class="n">sim_reset</span><span class="p">()</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">example_network_setup</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">depolar_rate</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="p">)</span>
        <span class="n">node_a</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
        <span class="n">node_b</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span>
        <span class="n">protocol_alice</span><span class="p">,</span> <span class="n">protocol_bob</span><span class="p">,</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">example_sim_setup</span><span class="p">(</span><span class="n">node_a</span><span class="p">,</span> <span class="n">node_b</span><span class="p">)</span>
        <span class="n">protocol_alice</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">protocol_bob</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">q_conn</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="n">node_a</span><span class="p">,</span> <span class="n">node_b</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;quantum&quot;</span><span class="p">)</span>
        <span class="n">cycle_runtime</span> <span class="o">=</span> <span class="p">(</span><span class="n">q_conn</span><span class="o">.</span><span class="n">subcomponents</span><span class="p">[</span><span class="s2">&quot;qsource&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">subcomponents</span><span class="p">[</span><span class="s2">&quot;internal_clock&quot;</span><span class="p">]</span>
                         <span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="s2">&quot;timing_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="n">cycle_runtime</span> <span class="o">*</span> <span class="n">num_runs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">dataframe</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depolar_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depolar_rate</span>
        <span class="n">fidelity_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">fidelity_data</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">fidelity_data</span>
</pre></div>
</div>
<p>We make use of the matplotlib library to show the figure when running a full simulation.
This library is not part of the requirements, so needs to be installed manually if you want to generate the plot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show a plot of fidelity verus depolarization rate.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="n">depolar_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
    <span class="n">fidelities</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">num_runs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">4e-3</span><span class="p">,</span>
                                <span class="n">depolar_rates</span><span class="o">=</span><span class="n">depolar_rates</span><span class="p">,</span> <span class="n">dephase_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">plot_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Fidelity of the teleported quantum state&quot;</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fidelities</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;depolar_rate&quot;</span><span class="p">)[</span><span class="s1">&#39;fidelity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="n">fidelity</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">sem</span><span class="o">=</span><span class="s1">&#39;sem&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;depolar_rate&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;fidelity&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s1">&#39;sem&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_style</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="_images/teleportation_fidelity_plot.png" src="_images/teleportation_fidelity_plot.png" />
</figure>
<p>We currently create the qubit to teleport the moment the protocol starts. This is inefficient because the qubit is then
stored and decohering in Alices memory for a long time before entanglement is created between Alice and Bob. Can you
optimize the protocol so as to minimize the time Alice her qubit is in her memory?</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial.quantumprocessor.html" class="btn btn-neutral float-left" title="The Quantum Processor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="learn.examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2021, TNO and TUDelft (QuTech).</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 1.1.7
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      <dd><a href="/1-1-stable/">1.1.5</a></dd>
      <dd><a href="/1-0-stable/">1.0.7</a></dd>
      <dd><a href="/0-10-stable/">0.10.4</a></dd>
      <dd><a href="/0-9-stable/">0.9.11</a></dd>
      <dd><a href="/0-8-stable/">0.8.7</a></dd>
      <dd><a href="/0-7-stable/">0.7.5</a></dd>
      <dd><a href="/0-6-stable/">0.6.4</a></dd>
      <dd><a href="/0-5-stable/">0.5.2</a></dd>
      <dd><a href="/0-4-stable/">0.4.2</a></dd>
      <dd><a href="/0-3-stable/">0.3.5</a></dd>
      <dd><a href="/latest-release/">latest release</a></dd>
      <dd><a href="/master/">master branch</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".highlight-default .highlight").each(function() {
            if ($(this).find(".gp").length > 0) {
             $(this).prepend("<div class='codebtn btn btn-neutral float-right'><div class='gp'>>>></div><div>");
             $(this).children("pre").contents().filter(function() {return this.nodeType === 3;}).wrap("<span></span>").end();
            }
        });
        $(".highlight-default .highlight .codebtn").click(function() {
            $(this).parent().children("pre").find(".gp").toggleClass("hidden");
            var traceback_elem = $(this).parent().children("pre").find(".gt, .go");
            traceback_elem.toggleClass("hidden");
            traceback_elem.nextUntil(".gp, .go").toggleClass("hidden");

        })
    });
</script>


</body>
</html>