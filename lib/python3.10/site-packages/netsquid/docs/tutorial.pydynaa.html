<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discrete event simulation &mdash; NetSquid 1.1.7 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=370aedac"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modelling of network components" href="tutorial.components.html" />
    <link rel="prev" title="Qubits and quantum computation" href="tutorial.qubits.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #E3E3E3" >

          
          
          <a href="index.html" class="icon icon-home">
            NetSquid
              <img src="_static/squid-150.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.1.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUTHORS.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learn NetSquid</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">NetSquid in 10 minutes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.intro.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.qubits.html">Qubits and quantum computation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Discrete event simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.components.html">Modelling of network components</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.nodes.html">Nodes and Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.protocols.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.quantumprocessor.html">The Quantum Processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.simulation.html">A full simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="learn.examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.teleportation.html">Teleportation</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.repeater.html">Repeater with purification</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.repeater_chain.html">Repeater chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.simple_link.html">A simple link layer protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_examples/learn.examples.magic_simple_link.html">Faster Link layer Protocol using abstraction</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">NetSquid package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="netsquid.qubits.html">netsquid.qubits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qformalism.html">netsquid.qubits.qformalism</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qubitapi.html">netsquid.qubits.qubitapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.operators.html">netsquid.qubits.operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.cliffords.html">netsquid.qubits.cliffords</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.ketstates.html">netsquid.qubits.ketstates</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.state_sampler.html">netsquid.qubits.state_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qubit.html">netsquid.qubits.qubit</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qstate.html">netsquid.qubits.qstate</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qrepr.html">netsquid.qubits.qrepr</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.kettools.html">netsquid.qubits.kettools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.dmtools.html">netsquid.qubits.dmtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.sparsedmtools.html">netsquid.qubits.sparsedmtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.stabtools.html">netsquid.qubits.stabtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.gslctools.html">netsquid.qubits.gslctools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.qreprutil.html">netsquid.qubits.qreprutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.ketutil.html">netsquid.qubits.ketutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.dmutil.html">netsquid.qubits.dmutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.sparseutil.html">netsquid.qubits.sparseutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.gslcutil.html">netsquid.qubits.gslcutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_qubits/netsquid.qubits.opmath.html">netsquid.qubits.opmath</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.components.html">netsquid.components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.component.html">netsquid.components.component</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.channel.html">netsquid.components.channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qchannel.html">netsquid.components.qchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.cchannel.html">netsquid.components.cchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.cqchannel.html">netsquid.components.cqchannel</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qmemory.html">netsquid.components.qmemory</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.instructions.html">netsquid.components.instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qprogram.html">netsquid.components.qprogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qprocessor.html">netsquid.components.qprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.clock.html">netsquid.components.clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qsource.html">netsquid.components.qsource</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.qdetector.html">netsquid.components.qdetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.switch.html">netsquid.components.switch</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_components/netsquid.components.ccoding.html">netsquid.components.ccoding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.components.models.html">netsquid.components.models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.model.html">netsquid.components.models.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.delaymodels.html">netsquid.components.models.delaymodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.errormodels.html">netsquid.components.models.errormodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.qerrormodels.html">netsquid.componentsmodels.qerrormodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_models/netsquid.components.models.cerrormodels.html">netsquid.components.models.cerrormodels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.nodes.html">netsquid.nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.node.html">netsquid.nodes.node</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.connections.html">netsquid.nodes.connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nodes/netsquid.nodes.network.html">netsquid.nodes.network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.protocols.html">netsquid.protocols</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.protocol.html">netsquid.protocols.protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.nodeprotocols.html">netsquid.protocols.nodeprotocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_protocols/netsquid.protocols.serviceprotocol.html">netsquid.protocols.serviceprotocol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.util.html">netsquid.util</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simtools.html">netsquid.util.simtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simlog.html">netsquid.util.simlog</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.simstats.html">netsquid.util.simstats</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.datacollector.html">netsquid.util.datacollector</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.cycache.html">netsquid.util.cycache</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.cymath.html">netsquid.util.cymath</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_util/netsquid.util.constrainedmap.html">netsquid.util.constrainedmap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="netsquid.examples.html">netsquid.examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.teleportation.html">netsquid.examples.teleportation</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.entanglenodes.html">netsquid.examples.entanglenodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.purify.html">netsquid.examples.purify</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.repeater.html">netsquid.examples.repeater</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.repeater_chain.html">netsquid.examples.repeater_chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.simple_link.html">netsquid.examples.simple_link</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_examples/netsquid.examples.magic_simple_link.html">netsquid.examples.magic_simple_link</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_pydynaa.html">pyDynAA package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html">pydynaa.Entity</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-event">pydynaa.Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventtype">pydynaa.EventType</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventexpression">pydynaa.EventExpression</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-eventhandler">pydynaa.EventHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-expressionhandler">pydynaa.ExpressionHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pydynaa.html#pydynaa-simulationengine">pydynaa.SimulationEngine</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="INSTALL-SOURCE.html">Installation from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #E3E3E3" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NetSquid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorial.intro.html">Tutorial</a></li>
      <li class="breadcrumb-item active">Discrete event simulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.pydynaa.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="tutorial.qubits.html" class="btn btn-neutral float-left" title="Qubits and quantum computation" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.components.html" class="btn btn-neutral float-right" title="Modelling of network components" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="discrete-event-simulation">
<h1>Discrete event simulation<a class="headerlink" href="#discrete-event-simulation" title="Link to this heading"></a></h1>
<p>In the previous example quantum teleportation was demonstrated in terms of qubits and their shared quantum states.
This included the effects of quantum noise due to Bob’s qubit having to wait for Alice’s classical corrections to arrive.
In this part of the tutorial we extend teleportation with a timing model by using the <em>pydynaa</em> <a class="reference external" href="https://en.wikipedia.org/wiki/Discrete-event_simulation">discrete event simulation</a> engine.</p>
<p>Using a discrete event simulator for quantum networks requires that the quantum states present in the network can be updated or evolved in discrete time steps.
In other words, it should be possible to derive and apply quantum operations that model arbitrary passages of time.
By restricting ourselves to discrete variable quantum systems, and more specifically systems described by qubits, this is fortunately the case.</p>
<p>Below we will present several quantum inspired examples of how to use the discrete event simulation engine.
For pedagogic reasons these examples don’t make use of the full network component modelling or protocol machinery of NetSquid that will significantly improve and shorten the examples presented below – these tools will be presented in later sections of this tutorial.</p>
<p class="topic-title">Learning goals</p><ul class="simple">
<li><p>Getting familiar with discrete event simulation
(<strong>essential</strong>).</p></li>
<li><p>Scheduling and handling events and running a simulation
(<strong>essential</strong>).</p></li>
<li><p>Defining and handling event expressions
(<strong>advanced</strong>).</p></li>
</ul>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#the-pydynaa-simulation-engine" id="id2">The pyDynAA simulation engine</a></p></li>
<li><p><a class="reference internal" href="#scheduling-events" id="id3">Scheduling events</a></p></li>
<li><p><a class="reference internal" href="#waiting-for-and-handling-events" id="id4">Waiting for and handling events</a></p></li>
<li><p><a class="reference internal" href="#running-a-simulation" id="id5">Running a simulation</a></p></li>
<li><p><a class="reference internal" href="#event-expressions-by-example-quantum-teleportation" id="id6">Event expressions by example: quantum teleportation <sup>*</sup></a></p></li>
</ul>
</nav>
<p><em>Advanced sections are denoted by an asterix (*).</em></p>
<section id="the-pydynaa-simulation-engine">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">The pyDynAA simulation engine</a><a class="headerlink" href="#the-pydynaa-simulation-engine" title="Link to this heading"></a></h2>
<p>The simulation package pyDynAA defines a handful of classes that represent its key concepts.
Namely these concepts (classes) are the <em>entities</em> of a simulation (<a class="reference internal" href="pydynaa.html#pydynaa.core.Entity" title="pydynaa.core.Entity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Entity</span></code></a>), <em>events</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.Event" title="pydynaa.core.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a>) of a <em>specific type</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventType" title="pydynaa.core.EventType"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventType</span></code></a>) that occur at scheduled times during a simulation run, <em>event expressions</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventExpression" title="pydynaa.core.EventExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventExpression</span></code></a>) that can be used to describe logical event combinations, <em>handlers objects</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventHandler" title="pydynaa.core.EventHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventHandler</span></code></a> and <a class="reference internal" href="pydynaa.html#pydynaa.core.ExpressionHandler" title="pydynaa.core.ExpressionHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionHandler</span></code></a>) that respond to triggered events, and the <em>simulation engine</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.SimulationEngine" title="pydynaa.core.SimulationEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulationEngine</span></code></a>) that manages the event scheduling and handler registration.</p>
<p>Simulation entities are anything in the simulation world that can generate or respond to events.
The Entity base class, which should always be sub-classed, provides methods for <em>scheduling</em> events and <em>waiting</em> for them.
Scheduled events will occur at given <em>instances</em> on the simulation timeline.
The simulation engine <em>runs</em> by stepping sequentially from event to event in a <em>discrete</em> fashion.
An entity can respond to events by registering an event handler object with a callback function to <em>wait</em> for event(s) with specified or unspecified type, source, and id to be triggered.</p>
<p>The following diagram illustrates several key classes and their interactions:</p>
<img alt="_images/pydynaa.png" class="align-center" src="_images/pydynaa.png" />
<p>The simulation engine is a singleton object that NetSquid has wrapped with convenience functions such as <a class="reference internal" href="api_util/netsquid.util.simtools.html#netsquid.util.simtools.sim_run" title="netsquid.util.simtools.sim_run"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_run()</span></code></a>, <a class="reference internal" href="api_util/netsquid.util.simtools.html#netsquid.util.simtools.sim_stop" title="netsquid.util.simtools.sim_stop"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_stop()</span></code></a>, <a class="reference internal" href="api_util/netsquid.util.simtools.html#netsquid.util.simtools.sim_reset" title="netsquid.util.simtools.sim_reset"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_reset()</span></code></a>, <a class="reference internal" href="api_util/netsquid.util.simtools.html#netsquid.util.simtools.sim_time" title="netsquid.util.simtools.sim_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_time()</span></code></a>, etc. See the <a class="reference internal" href="api_util/netsquid.util.simtools.html#module-netsquid.util.simtools" title="netsquid.util.simtools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">simtools</span></code></a> module for the full simulation API.</p>
<section id="a-quantum-ping-pong-example">
<h3>A quantum ping pong example<a class="headerlink" href="#a-quantum-ping-pong-example" title="Link to this heading"></a></h3>
<p>To illustrate how pyDynAA works let us consider an example of a game of ping pong played with a qubit.
Similarly to the <a class="reference external" href="quick_start.html">10 minute tutorial</a>.
We begin by importing the NetSquid and pyDynAA packages.
To ensure our output is reproducible we also fix the seed to NetSquid’s random number generator, which will be used in the example below to perform the quantum measurements.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">netsquid</span> <span class="k">as</span> <span class="nn">ns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydynaa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">set_random_state</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>For our game of quantum ping pong we define two simulation entities, <em>PingEntity</em> and <em>PongEntity</em>, which both subclass from the <a class="reference internal" href="pydynaa.html#pydynaa.core.Entity" title="pydynaa.core.Entity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Entity</span></code></a> class.
This sub-classing (inheritance) is essential because only entities may schedule events on the simulation engine timeline or listen to them.</p>
<a class="reference internal image-reference" href="_images/aafig-d336e92767c3260d7e0bb3f54258a8f2550b98c8.svg" id="pingpong-example"><img alt="_images/aafig-d336e92767c3260d7e0bb3f54258a8f2550b98c8.svg" class="align-center" height="104.0" id="pingpong-example" src="_images/aafig-d336e92767c3260d7e0bb3f54258a8f2550b98c8.svg" width="762.0" /></a>
<p>Our ping and pong entities will take turns to react to each other’s ping and pong events and measure a shared qubit in the standard (<span class="math notranslate nohighlight">\((\vert 0\rangle, \vert 1\rangle)\)</span>) or
Hadamard (<span class="math notranslate nohighlight">\((\vert +\rangle, \vert -\rangle)\)</span>) basis, respectively.
The two entities can be setup as follows, which we explain in more detail directly below.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PingEntity</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ping_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;PING_EVENT&quot;</span><span class="p">,</span> <span class="s2">&quot;A ping event.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">delay</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qubit</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Start the game by scheduling the first ping event after delay</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">qubit</span> <span class="o">=</span> <span class="n">qubit</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">PingEntity</span><span class="o">.</span><span class="n">ping_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">wait_for_pong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pong_entity</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Setup this entity to listen for pong events from a PongEntity</span>
<span class="gp">... </span>        <span class="n">pong_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_pong_event</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">pong_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="n">pong_entity</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">event_type</span><span class="o">=</span><span class="n">PongEntity</span><span class="o">.</span><span class="n">pong_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_handle_pong_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function called by the pong handler when pong event is triggered</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qubit</span><span class="p">,</span> <span class="n">observable</span><span class="o">=</span><span class="n">ns</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">labels_z</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;|0&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;|1&gt;&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Pong event! PingEntity measured &quot;</span>
<span class="gp">... </span>              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels_z</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="si">}</span><span class="s2"> with probability </span><span class="si">{</span><span class="n">prob</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="n">PingEntity</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">PingEntity</span><span class="o">.</span><span class="n">ping_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PongEntity</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">pong_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;PONG_EVENT&quot;</span><span class="p">,</span> <span class="s2">&quot;A pong event.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">delay</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">wait_for_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ping_entity</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Setup this entity to listen for ping events from a PingEntity</span>
<span class="gp">... </span>        <span class="n">ping_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_ping_event</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">ping_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="n">ping_entity</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">event_type</span><span class="o">=</span><span class="n">PingEntity</span><span class="o">.</span><span class="n">ping_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_handle_ping_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function called by the ping handler when ping event is triggered</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">qubit</span><span class="p">,</span> <span class="n">observable</span><span class="o">=</span><span class="n">ns</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">labels_x</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;|+&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;|-&gt;&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Ping event! PongEntity measured &quot;</span>
<span class="gp">... </span>              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels_x</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="si">}</span><span class="s2"> with probability </span><span class="si">{</span><span class="n">prob</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="n">PongEntity</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">PongEntity</span><span class="o">.</span><span class="n">pong_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create entities and register them to each other</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ping</span> <span class="o">=</span> <span class="n">PingEntity</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pong</span> <span class="o">=</span> <span class="n">PongEntity</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ping</span><span class="o">.</span><span class="n">wait_for_pong</span><span class="p">(</span><span class="n">pong</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pong</span><span class="o">.</span><span class="n">wait_for_ping</span><span class="p">(</span><span class="n">ping</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a qubit and instruct the ping entity to start</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qubit</span><span class="p">,</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">create_qubits</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ping</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="scheduling-events">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Scheduling events</a><a class="headerlink" href="#scheduling-events" title="Link to this heading"></a></h2>
<p>The game is started (but the simulation not yet run) by calling the <code class="docutils literal notranslate"><span class="pre">start()</span></code> method of the ping entity and passing the qubit to be ping-ponged as a parameter.
In the example above the qubit starts in the <span class="math notranslate nohighlight">\(\vert 0\rangle\)</span> state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">class</span> <span class="nc">PingEntity</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="hll"><span class="linenos">2</span>    <span class="n">ping_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;PING_EVENT&quot;</span><span class="p">,</span> <span class="s2">&quot;A ping event.&quot;</span><span class="p">)</span>
</span><span class="linenos">3</span>    <span class="n">delay</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="linenos">4</span>
<span class="linenos">5</span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qubit</span><span class="p">):</span>
<span class="linenos">6</span>        <span class="c1"># Start the game by immediately scheduling the first ping event</span>
<span class="linenos">7</span>        <span class="bp">self</span><span class="o">.</span><span class="n">qubit</span> <span class="o">=</span> <span class="n">qubit</span>
<span class="hll"><span class="linenos">8</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_now</span><span class="p">(</span><span class="n">PingEntity</span><span class="o">.</span><span class="n">ping_evtype</span><span class="p">)</span>
</span></pre></div>
</div>
<p>From inspecting the start method we see that the qubit is stored for later use, after which the entity immediately schedules an event using the <a class="reference internal" href="pydynaa.html#pydynaa.core.Entity._schedule_now" title="pydynaa.core.Entity._schedule_now"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_schedule_now()</span></code></a> method (line 8).
To schedule an event it is always necessary to specify the type (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventType" title="pydynaa.core.EventType"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventType</span></code></a>), which in this case is defined by the class attribute <em>ping_evtype</em>.
Note that the methods inherited from the Entity class that relate to scheduling and listening, such as <em>_schedule_now()</em>, start with an underscore to indicate they are private to the subclassing entity i.e. only this entity itself should call them.</p>
</section>
<section id="waiting-for-and-handling-events">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Waiting for and handling events</a><a class="headerlink" href="#waiting-for-and-handling-events" title="Link to this heading"></a></h2>
<p>To keep the game going the pong entity has been setup to listen and respond to ping events by the <em>wait_for_ping()</em> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">wait_for_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ping_entity</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="c1"># Setup this entity to listen for ping events from a PingEntity</span>
<span class="hll"><span class="linenos">3</span>    <span class="n">ping_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_ping_event</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">4</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">ping_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="n">ping_entity</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">PingEntity</span><span class="o">.</span><span class="n">ping_evtype</span><span class="p">)</span>
</span></pre></div>
</div>
<p>The <em>wait_for_ping()</em> method first creates an event handler (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventHandler" title="pydynaa.core.EventHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventHandler</span></code></a>) that references the callback function to call when a ping event is triggered.
It then passes this event handler to the entity’s <a class="reference internal" href="pydynaa.html#pydynaa.core.Entity._wait" title="pydynaa.core.Entity._wait"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_wait()</span></code></a> method along with a specification of the events to trigger on: in this case events scheduled by the <em>ping_entity</em> and of type <em>PingEntity.ping_evtype</em>.
The pong entity will now continuously wait and handle all matching ping events that occur.
If instead it only wished to wait for and handle the first event, it could have used the <a class="reference internal" href="pydynaa.html#pydynaa.core.Entity._wait_once" title="pydynaa.core.Entity._wait_once"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_wait_once()</span></code></a> method instead.</p>
<p>The callback function referenced by the event handler created in the <em>wait_for_ping()</em> method is the <em>_handle_ping_event()</em> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">_handle_ping_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="c1"># Callback function called by the ping handler when a ping event is triggered</span>
<span class="linenos">3</span>    <span class="n">m</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">qubit</span><span class="p">,</span> <span class="n">observable</span><span class="o">=</span><span class="n">ns</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
<span class="linenos">4</span>    <span class="n">labels_x</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;|+&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;|-&gt;&quot;</span><span class="p">)</span>
<span class="linenos">5</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Ping event! PongEntity measured </span><span class="si">{</span><span class="n">labels_x</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
<span class="linenos">6</span>          <span class="sa">f</span><span class="s2">&quot;with probability </span><span class="si">{</span><span class="n">prob</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="hll"><span class="linenos">7</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="n">PongEntity</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">PongEntity</span><span class="o">.</span><span class="n">pong_evtype</span><span class="p">)</span>
</span></pre></div>
</div>
<p>A callback function of an event handler is passed the triggered event (<a class="reference internal" href="pydynaa.html#pydynaa.core.Event" title="pydynaa.core.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a>) as an argument.
In the example above the event is used to retrieve its <em>source</em>, the ping entity,
which the pong entity uses to access the shared qubit.
Note that in later sections we will introduce quantum components that can be used to properly exchange quantum information.
The pong entity measures the qubit in the Hadamard basis and prints the result.
Finally, it schedules an event of type <em>pong_evtype</em> to occur after a fixed delay using the <a class="reference internal" href="pydynaa.html#pydynaa.core.Entity._schedule_after" title="pydynaa.core.Entity._schedule_after"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_schedule_after()</span></code></a> method.</p>
<p>The ping entity has been setup to analogously listen and react to pong events.
The only difference is that it measures the qubit in the standard basis.
This game of quantum ping pong will continue indefinitely,
as new events are dynamically generated after every ping and pong.</p>
</section>
<section id="running-a-simulation">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Running a simulation</a><a class="headerlink" href="#running-a-simulation" title="Link to this heading"></a></h2>
<p>Now let’s run the simulation using the <a class="reference internal" href="api_util/netsquid.util.simtools.html#netsquid.util.simtools.sim_run" title="netsquid.util.simtools.sim_run"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_run()</span></code></a> function.
When no arguments are specified the simulation engine runs until there are no scheduled events remaining on its future timeline.
To limit the run time, which would otherwise be infinite for our ping pong game, we can specify either an <em>end_time</em> or <em>duration</em> parameter.
In both cases the simulation engine will run up to the time limit specified, but not yet trigger any events scheduled at that instant.
Thus to ensure also the event scheduled at 90 ns (nanoseconds is the default time unit in NetSquid) is printed, we will specify an <em>end time</em> of 91 ns.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="n">end_time</span><span class="o">=</span><span class="mi">91</span><span class="p">)</span>
<span class="go">10.0: Ping event! PongEntity measured |+&gt; with probability 0.50</span>
<span class="go">20.0: Pong event! PingEntity measured |1&gt; with probability 0.50</span>
<span class="go">30.0: Ping event! PongEntity measured |-&gt; with probability 0.50</span>
<span class="go">40.0: Pong event! PingEntity measured |1&gt; with probability 0.50</span>
<span class="go">50.0: Ping event! PongEntity measured |+&gt; with probability 0.50</span>
<span class="go">60.0: Pong event! PingEntity measured |0&gt; with probability 0.50</span>
<span class="go">70.0: Ping event! PongEntity measured |+&gt; with probability 0.50</span>
<span class="go">80.0: Pong event! PingEntity measured |1&gt; with probability 0.50</span>
<span class="go">90.0: Ping event! PongEntity measured |-&gt; with probability 0.50</span>
</pre></div>
</div>
<p>The run function outputs a <a class="reference internal" href="api_util/netsquid.util.simstats.html#netsquid.util.simstats.SimStats" title="netsquid.util.simstats.SimStats"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimStats</span></code></a> object that has recorded interesting statistics about the simulation.
To see a summary we can print this object:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

<span class="go">Simulation summary</span>
<span class="go">==================</span>

<span class="go">Elapsed wallclock time: ...</span>
<span class="go">Elapsed simulation time: 9.10e+01 [ns]</span>
<span class="go">Triggered events: 9</span>
<span class="go">Handled callbacks: 9</span>
<span class="go">Total quantum operations: 9</span>
<span class="go">Frequent quantum operations: MEASURE = 9</span>
<span class="go">Max qstate size: 1 qubits</span>
<span class="go">Mean qstate size: 1.00 qubits</span>
</pre></div>
</div>
<p>We see that the simulation indeed tooks 91 nanoseconds,
and that exactly 9 events were scheduled and handled.
There were also 9 quantum operations, our measurements,
and the maximum quantum state size operated on was 1 qubit, as expected.</p>
</section>
<section id="event-expressions-by-example-quantum-teleportation">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Event expressions by example: quantum teleportation <sup>*</sup></a><a class="headerlink" href="#event-expressions-by-example-quantum-teleportation" title="Link to this heading"></a></h2>
<p>Let us now consider a more involved example that extends the previous quantum teleportation example with discrete events.
First we reset the simulation timeline, which clears any events still on the timeline and sets the simulation time back to zero:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">sim_reset</span><span class="p">()</span>
</pre></div>
</div>
<p>We will define three simulation entities: Alice, Bob, and Charlie.
Charlie will be responsible for continuously generating an entangled pair of qubits (the <span class="math notranslate nohighlight">\(\vert B_{00}\rangle\)</span> Bell state), with one qubit intended for Alice and the other for Bob.
Alice will wait for her entangled qubit to arrive, and once it does she will entangle her own qubit with it, measure both and send the classical corrections to Bob.
Bob will simultaneously wait on both his entangled qubit from Charlie and the classical correction information from Alice.
To do that he will make use of so called <em>event expressions</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventExpression" title="pydynaa.core.EventExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventExpression</span></code></a>), as we will soon explain.</p>
<a class="reference internal image-reference" href="_images/aafig-68b936f1a385af8661132617442f6cf318b973f5.svg" id="teleportation-example"><img alt="_images/aafig-68b936f1a385af8661132617442f6cf318b973f5.svg" class="align-center" height="230.0" id="teleportation-example" src="_images/aafig-68b936f1a385af8661132617442f6cf318b973f5.svg" width="566.0" /></a>
<p>The Charlie entity class is implemented as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Charlie</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ready_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;QUBITS_READY&quot;</span><span class="p">,</span> <span class="s2">&quot;Entangled qubits are ready.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_generate_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;GENERATE&quot;</span><span class="p">,</span> <span class="s2">&quot;Generate entangled qubits.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">period</span> <span class="o">=</span> <span class="mf">50.</span>
<span class="gp">... </span>    <span class="n">delay</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Initialise Charlie by entangling qubits after every generation event</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">entangled_qubits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entangle_qubits</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">event_type</span><span class="o">=</span><span class="n">Charlie</span><span class="o">.</span><span class="n">_generate_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_entangle_qubits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function that entangles qubits and schedules an</span>
<span class="gp">... </span>        <span class="c1"># entanglement ready event</span>
<span class="gp">... </span>        <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">create_qubits</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">operate</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">],</span> <span class="n">ns</span><span class="o">.</span><span class="n">CNOT</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">entangled_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">]</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="n">Charlie</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">Charlie</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Charlie finished generating entanglement&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="n">Charlie</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="n">Charlie</span><span class="o">.</span><span class="n">_generate_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Begin generating entanglement</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Charlie start generating entanglement&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_now</span><span class="p">(</span><span class="n">Charlie</span><span class="o">.</span><span class="n">_generate_evtype</span><span class="p">)</span>
</pre></div>
</div>
<p>It uses the same basic ingredients as the entities in the ping pong example to schedule and wait for events.
In this case we define two event types: a private <em>_generate_evtype</em> that is used to simulate a frequency in generating entanglement, and the public <em>ready_evtype</em> that is used to signal the successful generation of entanglement to Alice and Bob.
The callback function of the <em>_generate_handler()</em> is seen to schedule the ready event after a delay, and then scheduling the next generation event.</p>
<p>The Alice entity class similarly defines the public and private event types <em>ready_evtype</em> and <em>_teleport_evtype</em>.
The former communicates to Bob that his classical corrections are ready e.g. have been transmitted to him (later we will explain how to model transmission with channel components).
The latter is used to simulate a delay in performing Alice’s local teleport operation.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Alice</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ready_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;CORRECTION_READY&quot;</span><span class="p">,</span> <span class="s2">&quot;Corrections are ready.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_teleport_evtype</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;TELEPORT&quot;</span><span class="p">,</span> <span class="s2">&quot;Teleport the qubit.&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">delay</span> <span class="o">=</span> <span class="mf">20.</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teleport_state</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Initialise Alice by setting the teleport state and waiting to teleport</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">teleport_state</span> <span class="o">=</span> <span class="n">teleport_state</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">corrections</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_teleport_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_teleport</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_teleport_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">event_type</span><span class="o">=</span><span class="n">Alice</span><span class="o">.</span><span class="n">_teleport_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">wait_for_charlie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">charlie</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Setup Alice to wait for an entanglement qubit from Charlie</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_qubit_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_qubit</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qubit_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="n">charlie</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">event_type</span><span class="o">=</span><span class="n">Charlie</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_handle_qubit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function that handles arrival of entangled qubit</span>
<span class="gp">... </span>        <span class="c1"># and schedules teleportation</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">,</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">create_qubits</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">no_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">entangled_qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">assign_qstate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">teleport_state</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_after</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">Alice</span><span class="o">.</span><span class="n">_teleport_evtype</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Alice received entangled qubit&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_handle_teleport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function that does teleportation and schedules</span>
<span class="gp">... </span>        <span class="c1"># a corrections ready event</span>
<span class="gp">... </span>        <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">operate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="p">],</span> <span class="n">ns</span><span class="o">.</span><span class="n">CNOT</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">m0</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">m1</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">corrections</span> <span class="o">=</span> <span class="p">[</span><span class="n">m0</span><span class="p">,</span> <span class="n">m1</span><span class="p">]</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_now</span><span class="p">(</span><span class="n">Alice</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Alice measured qubits &amp; sending corrections&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Alice is seen to define two separate event handlers with corresponding callback functions.</p>
<p>It is Bob’s job to  wait until both the entangled qubit from Charlie and the classical corrections from Alice are ready, at which point he will finish the teleportation task by applying possible corrections to his local qubit.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Bob</span><span class="p">(</span><span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">wait_for_teleport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alice</span><span class="p">,</span> <span class="n">charlie</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Setup Bob to wait for his entangled qubit and Alice&#39;s corrections</span>
<span class="gp">... </span>        <span class="n">charlie_ready_evexpr</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventExpression</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="n">charlie</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">Charlie</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">alice_ready_evexpr</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventExpression</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="n">alice</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">Alice</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">both_ready_evexpr</span> <span class="o">=</span> <span class="n">charlie_ready_evexpr</span> <span class="o">&amp;</span> <span class="n">alice_ready_evexpr</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_teleport_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">ExpressionHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_teleport</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_teleport_handler</span><span class="p">,</span> <span class="n">expression</span><span class="o">=</span><span class="n">both_ready_evexpr</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_handle_teleport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_expression</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function that handles messages from both Alice and Charlie</span>
<span class="gp">... </span>        <span class="n">qubit</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">atomic_source</span><span class="o">.</span><span class="n">entangled_qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">alice</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">second_term</span><span class="o">.</span><span class="n">atomic_source</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_corrections</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">alice</span><span class="o">.</span><span class="n">corrections</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_apply_corrections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">corrections</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Apply teleportation corrections and check fidelity</span>
<span class="gp">... </span>        <span class="n">m0</span><span class="p">,</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">corrections</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">m1</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">m0</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">fidelity</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">fidelity</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">alice</span><span class="o">.</span><span class="n">teleport_state</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: Bob received entangled qubit and corrections!&quot;</span>
<span class="gp">... </span>              <span class="sa">f</span><span class="s2">&quot; Fidelity = </span><span class="si">{</span><span class="n">fidelity</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To wait for both Alice and Bob simultaneously Bob makes use of <em>event expressions</em> (<a class="reference internal" href="pydynaa.html#pydynaa.core.EventExpression" title="pydynaa.core.EventExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventExpression</span></code></a>) in the <em>wait_for_teleport()</em> method.
Event expressions can be either <em>atomic</em> or <em>composite</em>.
An <em>atomic</em> event expressions describes future events similarly to a call to <em>_wait()</em> or <em>_wait_once()</em> does: the source, type and id of the event(s) can all be optionally specified.
A <em>composite</em> expression combines two atomic or composite expressions with a logical <em>AND</em> or <em>OR</em>.
An event expression can be used in combination with event expression handlers (<a class="reference internal" href="pydynaa.html#pydynaa.core.ExpressionHandler" title="pydynaa.core.ExpressionHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionHandler</span></code></a>) in calls to <em>_wait()</em> and <em>_wait_once()</em>.
For example, below we demonstrate multiple ways to <em>wait</em> for specific events with and without an atomic event expression:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># (entity, event_type, id) of events we wish to wait for</span>
<span class="n">my_source</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">Entity</span><span class="p">()</span>  <span class="c1"># a generic entity for testing purposes only</span>
<span class="n">my_event_type</span> <span class="o">=</span> <span class="n">EventType</span><span class="p">(</span><span class="s2">&quot;TestType&quot;</span><span class="p">,</span> <span class="s2">&quot;Type for testing&quot;</span><span class="p">)</span>
<span class="n">my_id</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">any_id</span>

<span class="k">def</span> <span class="nf">event_handler_callback</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="c1"># Callback function that takes event as a parameter</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">expr_handler_callback</span><span class="p">(</span><span class="n">event_expression</span><span class="p">):</span>
    <span class="c1"># Callback function that takes event expression as a parameter</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">triggered_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

<span class="n">event_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="n">event_handler_callback</span><span class="p">)</span>
<span class="n">expr_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">ExpressionHandler</span><span class="p">(</span><span class="n">expr_handler_callback</span><span class="p">)</span>

<span class="c1"># Define an atomic event expression to represent</span>
<span class="n">atomic_expression</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventExpression</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">my_source</span><span class="p">,</span>
                                            <span class="n">event_type</span><span class="o">=</span><span class="n">my_event_type</span><span class="p">,</span>
                                            <span class="n">event_id</span><span class="o">=</span><span class="n">my_id</span><span class="p">)</span>

<span class="c1"># Following calls to wait for a specific (entity, event_type, id) are equivalent:</span>
<span class="n">myentity</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">expr_handler</span><span class="p">,</span> <span class="n">expression</span><span class="o">=</span><span class="n">atomic_expression</span><span class="p">)</span>
<span class="n">myentity</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">event_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="n">my_source</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">my_event_type</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">my_id</span><span class="p">)</span>

<span class="c1"># Also possible but not recommended:</span>
<span class="n">myentity</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">event_handler</span><span class="p">,</span> <span class="n">expression</span><span class="o">=</span><span class="n">atomic_expression</span><span class="p">)</span>
<span class="n">myentity</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">expr_handler</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="n">my_source</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">my_event_type</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">my_id</span><span class="p">)</span>
</pre></div>
</div>
<p>The real power of event expressions is due to the <em>composite</em> variety.
This is illustrated in the <em>wait_for_teleport()</em> method, where two event expressions are combined using a logical <em>AND</em> (represented by the &amp; operator):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">charlie_ready_evexpr</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventExpression</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">charlie</span><span class="p">,</span>
<span class="linenos">2</span>                                               <span class="n">event_type</span><span class="o">=</span><span class="n">Charlie</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">alice_ready_evexpr</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">EventExpression</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">alice</span><span class="p">,</span>
<span class="linenos">4</span>                                             <span class="n">event_type</span><span class="o">=</span><span class="n">Alice</span><span class="o">.</span><span class="n">ready_evtype</span><span class="p">)</span>
<span class="hll"><span class="linenos">5</span><span class="n">both_ready_evexpr</span> <span class="o">=</span> <span class="n">charlie_ready_evexpr</span> <span class="o">&amp;</span> <span class="n">alice_ready_evexpr</span>
</span></pre></div>
</div>
<p>The resulting composite event expression <em>both_ready_evexpr</em> will trigger (if waited on) only when both of the  atomic event expressions for Charlie and Alice have triggered.
This event expression can be handled using an expression handler, which wraps a callback function that expects the triggered event expression as an argument.
This allows the callback function to inspect the expressions for which events triggered, their sources, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">wait_for_teleport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alice</span><span class="p">,</span> <span class="n">charlie</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="o">...</span>
<span class="linenos"> 3</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_teleport_handler</span> <span class="o">=</span> <span class="n">pydynaa</span><span class="o">.</span><span class="n">ExpressionHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_teleport</span><span class="p">)</span>
<span class="linenos"> 4</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_teleport_handler</span><span class="p">,</span> <span class="n">expression</span><span class="o">=</span><span class="n">both_ready_evexpr</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="hll"><span class="linenos"> 6</span><span class="k">def</span> <span class="nf">_handle_teleport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_expression</span><span class="p">):</span>
</span><span class="linenos"> 7</span>    <span class="c1"># Callback function that applies corrections to Bob&#39;s qubit and reports fidelity</span>
<span class="linenos"> 8</span>    <span class="n">charlie</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">first_term</span><span class="o">.</span><span class="n">atomic_source</span>
<span class="linenos"> 9</span>    <span class="n">alice</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">second_term</span><span class="o">.</span><span class="n">atomic_source</span>
<span class="linenos">10</span>    <span class="o">...</span>
</pre></div>
</div>
<p>The entities classes we defined above for Alice, Bob, and Charlie can now be instantiated.
We have given Alice the qubit state <span class="math notranslate nohighlight">\(\vert -\rangle\)</span> to teleport to Bob.
We also define a funtion to link them to each other and to tell Charlie to begin generating and distributing entanglement.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">setup_network</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">,</span> <span class="n">charlie</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">alice</span><span class="o">.</span><span class="n">wait_for_charlie</span><span class="p">(</span><span class="n">charlie</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">bob</span><span class="o">.</span><span class="n">wait_for_teleport</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">charlie</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">charlie</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span> <span class="o">=</span> <span class="n">Alice</span><span class="p">(</span><span class="n">teleport_state</span><span class="o">=</span><span class="n">ns</span><span class="o">.</span><span class="n">h1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">Bob</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">charlie</span> <span class="o">=</span> <span class="n">Charlie</span><span class="p">()</span>
</pre></div>
</div>
<p>We now setup the network and run the simulation up to 100 ns to allow two rounds of teleportation:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">setup_network</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">,</span> <span class="n">charlie</span><span class="p">)</span>
<span class="go">0.0: Charlie start generating entanglement</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="n">end_time</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="go">0.0: Charlie finished generating entanglement</span>
<span class="go">10.0: Alice received entangled qubit</span>
<span class="go">30.0: Alice measured qubits &amp; sending corrections</span>
<span class="go">30.0: Bob received entangled qubit and corrections! Fidelity = 1.000</span>
<span class="go">50.0: Charlie finished generating entanglement</span>
<span class="go">60.0: Alice received entangled qubit</span>
<span class="go">80.0: Alice measured qubits &amp; sending corrections</span>
<span class="go">80.0: Bob received entangled qubit and corrections! Fidelity = 1.000</span>
</pre></div>
</div>
<p>We see from the reported fidelity values that Bob successfully received the <span class="math notranslate nohighlight">\(\vert -\rangle\)</span> state from Alice twice.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

<span class="go">Simulation summary</span>
<span class="go">==================</span>

<span class="go">Elapsed wallclock time: ...</span>
<span class="go">Elapsed simulation time: 1.00e+02 [ns]</span>
<span class="go">Triggered events: 8</span>
<span class="go">Handled callbacks: 10</span>
<span class="go">Total quantum operations: 15</span>
<span class="go">Frequent quantum operations: MEASURE = 4; H = 4; CX = 4; Z = 2; X = 1</span>
<span class="go">Max qstate size: 3 qubits</span>
<span class="go">Mean qstate size: 2.07 qubits</span>
</pre></div>
</div>
<p>The simulation statistics show that more handlers were called than events triggered.
That is due to our use of event expressions, which internally define some extra handler callbacks.
We further see that the maximum quantum state size achieved was 3 qubits, which occurs after Alice entangles the qubit to be teleported into the entangled pair generated by Charlie.</p>
<p>Finally, let us actually make use of our discrete event simulator by adding time-dependent noise to Bob’s waiting qubit.
We compute the time difference between the arrival of Bob’s qubit (from Charlie) and the current simulation time and pass this as the delay to the <a class="reference internal" href="api_qubits/netsquid.qubits.qubitapi.html#netsquid.qubits.qubitapi.delay_depolarize" title="netsquid.qubits.qubitapi.delay_depolarize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delay_depolarize()</span></code></a> function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NoisyBob</span><span class="p">(</span><span class="n">Bob</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">depolar_rate</span> <span class="o">=</span> <span class="mf">1e7</span>  <span class="c1"># depolarization rate of waiting qubits [Hz]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_handle_teleport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_expression</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Callback function that first applies noise to qubit before corrections</span>
<span class="gp">... </span>        <span class="n">alice_expr</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">second_term</span>
<span class="gp">... </span>        <span class="n">charlie_expr</span> <span class="o">=</span> <span class="n">event_expression</span><span class="o">.</span><span class="n">first_term</span>
<span class="gp">... </span>        <span class="c1"># Compute time that qubit from Charlie has been waiting:</span>
<span class="gp">... </span>        <span class="n">delay</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">charlie_expr</span><span class="o">.</span><span class="n">triggered_time</span>
<span class="gp">... </span>        <span class="c1"># Apply time-dependent quantum noise to Bob&#39;s qubit:</span>
<span class="gp">... </span>        <span class="n">qubit</span> <span class="o">=</span> <span class="n">charlie_expr</span><span class="o">.</span><span class="n">atomic_source</span><span class="o">.</span><span class="n">entangled_qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">ns</span><span class="o">.</span><span class="n">qubits</span><span class="o">.</span><span class="n">delay_depolarize</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">NoisyBob</span><span class="o">.</span><span class="n">depolar_rate</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># Apply classical corrections (as before):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_corrections</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">alice_expr</span><span class="o">.</span><span class="n">atomic_source</span><span class="o">.</span><span class="n">corrections</span><span class="p">)</span>
</pre></div>
</div>
<p>To immediately see the effect this has on the fidelity we switch to the density matrix formalism.
While this works for this simple case, measurements on a density matrix will still select only one random result,
which can make them no more useful than ket vectors, yet slower and more memory hungry.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">sim_reset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ns</span><span class="o">.</span><span class="n">set_qstate_formalism</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">QFormalism</span><span class="o">.</span><span class="n">DM</span><span class="p">)</span>
</pre></div>
</div>
<p>We now reinitialise our entities, this time with a <em>NoisyBob</em> and rerun our simulation once.
We observe that the noise on Bob’s qubit has caused a drop in fidelity of the teleported qubit.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">alice</span> <span class="o">=</span> <span class="n">Alice</span><span class="p">(</span><span class="n">teleport_state</span><span class="o">=</span><span class="n">ns</span><span class="o">.</span><span class="n">h1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">NoisyBob</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">charlie</span> <span class="o">=</span> <span class="n">Charlie</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setup_network</span><span class="p">(</span><span class="n">alice</span><span class="p">,</span> <span class="n">bob</span><span class="p">,</span> <span class="n">charlie</span><span class="p">)</span>
<span class="go">0.0: Charlie start generating entanglement</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">sim_run</span><span class="p">(</span><span class="n">end_time</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="go">0.0: Charlie finished generating entanglement</span>
<span class="go">10.0: Alice received entangled qubit</span>
<span class="go">30.0: Alice measured qubits &amp; sending corrections</span>
<span class="go">30.0: Bob received entangled qubit and corrections! Fidelity = 0.909</span>
</pre></div>
</div>
<section id="what-is-next">
<h3>What is next?<a class="headerlink" href="#what-is-next" title="Link to this heading"></a></h3>
<p>In the following sections of this tutorial we will present <em>entities</em> that model the components in a quantum network,
such as quantum and classical channels and quantum memories and processors.
These components will do much of the work of managing transmission and waiting times for you,
as well as automatically applying quantum error models.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial.qubits.html" class="btn btn-neutral float-left" title="Qubits and quantum computation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.components.html" class="btn btn-neutral float-right" title="Modelling of network components" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2021, TNO and TUDelft (QuTech).</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 1.1.7
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      <dd><a href="/1-1-stable/">1.1.5</a></dd>
      <dd><a href="/1-0-stable/">1.0.7</a></dd>
      <dd><a href="/0-10-stable/">0.10.4</a></dd>
      <dd><a href="/0-9-stable/">0.9.11</a></dd>
      <dd><a href="/0-8-stable/">0.8.7</a></dd>
      <dd><a href="/0-7-stable/">0.7.5</a></dd>
      <dd><a href="/0-6-stable/">0.6.4</a></dd>
      <dd><a href="/0-5-stable/">0.5.2</a></dd>
      <dd><a href="/0-4-stable/">0.4.2</a></dd>
      <dd><a href="/0-3-stable/">0.3.5</a></dd>
      <dd><a href="/latest-release/">latest release</a></dd>
      <dd><a href="/master/">master branch</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".highlight-default .highlight").each(function() {
            if ($(this).find(".gp").length > 0) {
             $(this).prepend("<div class='codebtn btn btn-neutral float-right'><div class='gp'>>>></div><div>");
             $(this).children("pre").contents().filter(function() {return this.nodeType === 3;}).wrap("<span></span>").end();
            }
        });
        $(".highlight-default .highlight .codebtn").click(function() {
            $(this).parent().children("pre").find(".gp").toggleClass("hidden");
            var traceback_elem = $(this).parent().children("pre").find(".gt, .go");
            traceback_elem.toggleClass("hidden");
            traceback_elem.nextUntil(".gp, .go").toggleClass("hidden");

        })
    });
</script>


</body>
</html>